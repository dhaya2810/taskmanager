<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow | Beautiful Task Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            /* Colors - Light Theme */
            --color-primary: 230, 60%, 60%;
            --color-secondary: 180, 40%, 60%;
            --color-accent: 350, 70%, 65%;
            --color-success: 142, 72%, 45%;
            --color-warning: 38, 92%, 50%;
            --color-error: 0, 84%, 60%;
            
            --color-background: 210, 40%, 98%;
            --color-surface: 0, 0%, 100%;
            --color-surface-glass: 0, 0%, 100%, 0.8;
            --color-text: 210, 20%, 20%;
            --color-text-muted: 210, 10%, 40%;
            --color-border: 210, 20%, 90%;
            
            /* Spacing */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-12: 3rem;
            
            /* Border Radius */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --shadow-glass: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            
            /* Transitions */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
            
            /* Typography */
            --font-family: 'Inter', system-ui, sans-serif;
            --line-height: 1.7;
        }

        [data-theme="dark"] {
            --color-background: 210, 20%, 8%;
            --color-surface: 210, 20%, 12%;
            --color-surface-glass: 210, 20%, 12%, 0.8;
            --color-text: 210, 10%, 95%;
            --color-text-muted: 210, 10%, 70%;
            --color-border: 210, 20%, 25%;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            line-height: var(--line-height);
            background-color: hsl(var(--color-background));
            color: hsl(var(--color-text));
            transition: background-color var(--transition-normal), color var(--transition-normal);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: hsl(var(--color-surface-glass));
            backdrop-filter: blur(16px) saturate(180%);
            border-right: 1px solid hsl(var(--color-border));
            padding: var(--space-6);
            display: flex;
            flex-direction: column;
            transition: transform var(--transition-normal);
            z-index: 10;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: var(--space-8);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: hsl(var(--color-primary));
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3);
            border-radius: var(--radius-lg);
            background: hsl(var(--color-surface));
            margin-bottom: var(--space-6);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: hsl(var(--color-primary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .nav-section {
            margin-bottom: var(--space-6);
        }

        .nav-title {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: hsl(var(--color-text-muted));
            margin-bottom: var(--space-3);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-2);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-bottom: var(--space-2);
        }

        .nav-item:hover {
            background: hsl(var(--color-surface));
        }

        .nav-item.active {
            background: hsl(var(--color-primary), 0.1);
            color: hsl(var(--color-primary));
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            padding: var(--space-6);
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
        }

        .view-title {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .header-actions {
            display: flex;
            gap: var(--space-3);
        }

        /* Glassmorphism Cards */
        .glass-card {
            background: hsl(var(--color-surface-glass));
            backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid hsl(var(--color-border));
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-glass);
            transition: all var(--transition-normal);
        }

        .glass-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        /* Task Card Styles */
        .task-card {
            padding: var(--space-4);
            margin-bottom: var(--space-4);
            cursor: grab;
            transition: all var(--transition-normal);
        }

        .task-card:active {
            cursor: grabbing;
        }

        .task-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-3);
        }

        .task-title {
            font-weight: 600;
            margin-bottom: var(--space-2);
        }

        .task-description {
            color: hsl(var(--color-text-muted));
            font-size: 0.875rem;
            margin-bottom: var(--space-3);
        }

        .task-meta {
            display: flex;
            gap: var(--space-3);
            flex-wrap: wrap;
        }

        .task-tag {
            background: hsl(var(--color-secondary), 0.1);
            color: hsl(var(--color-secondary));
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-lg);
            font-size: 0.75rem;
            font-weight: 500;
        }

        .task-priority {
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-lg);
            font-size: 0.75rem;
            font-weight: 500;
        }

        .priority-high {
            background: hsl(var(--color-error), 0.1);
            color: hsl(var(--color-error));
        }

        .priority-medium {
            background: hsl(var(--color-warning), 0.1);
            color: hsl(var(--color-warning));
        }

        .priority-low {
            background: hsl(var(--color-success), 0.1);
            color: hsl(var(--color-success));
        }

        /* Kanban Board */
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-4);
        }

        .kanban-column {
            background: hsl(var(--color-surface-glass));
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            min-height: 600px;
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-3);
            border-bottom: 1px solid hsl(var(--color-border));
        }

        .column-title {
            font-weight: 600;
        }

        .task-count {
            background: hsl(var(--color-surface));
            border-radius: var(--radius-lg);
            padding: var(--space-1) var(--space-3);
            font-size: 0.75rem;
            font-weight: 500;
        }

        .task-list {
            min-height: 500px;
        }

        /* Quick Add Input */
        .quick-add {
            position: relative;
            margin-bottom: var(--space-6);
        }

        .quick-add-input {
            width: 100%;
            padding: var(--space-4) var(--space-6);
            border-radius: var(--radius-xl);
            background: hsl(var(--color-surface-glass));
            backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid hsl(var(--color-border));
            font-size: 1rem;
            transition: all var(--transition-normal);
        }

        .quick-add-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px hsl(var(--color-primary), 0.2);
        }

        .quick-add-hint {
            position: absolute;
            right: var(--space-4);
            top: 50%;
            transform: translateY(-50%);
            color: hsl(var(--color-text-muted));
            font-size: 0.875rem;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .btn:after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }

        .btn-primary {
            background: hsl(var(--color-primary));
            color: white;
        }

        .btn-secondary {
            background: hsl(var(--color-surface));
            color: hsl(var(--color-text));
            border: 1px solid hsl(var(--color-border));
        }

        .btn-icon {
            padding: var(--space-2);
            border-radius: var(--radius-md);
        }

        /* Auth Styles */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: var(--space-6);
            background: linear-gradient(135deg, hsl(var(--color-primary), 0.1) 0%, hsl(var(--color-secondary), 0.1) 100%);
        }

        .auth-card {
            width: 100%;
            max-width: 400px;
            padding: var(--space-8);
        }

        .auth-title {
            text-align: center;
            margin-bottom: var(--space-6);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .form-label {
            font-weight: 500;
            font-size: 0.875rem;
        }

        .form-input {
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            border: 1px solid hsl(var(--color-border));
            background: hsl(var(--color-surface));
            transition: all var(--transition-fast);
        }

        .form-input:focus {
            outline: none;
            border-color: hsl(var(--color-primary));
            box-shadow: 0 0 0 3px hsl(var(--color-primary), 0.2);
        }

        .auth-divider {
            display: flex;
            align-items: center;
            margin: var(--space-4) 0;
            color: hsl(var(--color-text-muted));
        }

        .auth-divider:before,
        .auth-divider:after {
            content: '';
            flex: 1;
            height: 1px;
            background: hsl(var(--color-border));
        }

        .auth-divider span {
            padding: 0 var(--space-4);
            font-size: 0.875rem;
        }

        .google-btn {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            border: 1px solid hsl(var(--color-border));
            background: hsl(var(--color-surface));
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .google-btn:hover {
            background: hsl(var(--color-surface-glass));
        }

        .auth-links {
            display: flex;
            justify-content: space-between;
            margin-top: var(--space-4);
        }

        .auth-link {
            color: hsl(var(--color-primary));
            text-decoration: none;
            font-size: 0.875rem;
            cursor: pointer;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: var(--space-6);
            right: var(--space-6);
            padding: var(--space-4) var(--space-6);
            border-radius: var(--radius-lg);
            background: hsl(var(--color-surface));
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            transform: translateY(100px);
            opacity: 0;
            transition: all var(--transition-normal);
            z-index: 100;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-success {
            border-left: 4px solid hsl(var(--color-success));
        }

        .toast-error {
            border-left: 4px solid hsl(var(--color-error));
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            bottom: var(--space-6);
            left: var(--space-6);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: hsl(var(--color-surface));
            border: 1px solid hsl(var(--color-border));
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            z-index: 10;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                transform: translateX(-100%);
                position: fixed;
                height: 100%;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .kanban-board {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus styles for keyboard navigation */
        button:focus-visible, 
        input:focus-visible, 
        .nav-item:focus-visible {
            outline: 2px solid hsl(var(--color-primary));
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Auth Screen -->
    <div id="authScreen" class="auth-container">
        <div class="glass-card auth-card">
            <h1 class="auth-title">TaskFlow</h1>
            <form id="authForm" class="auth-form">
                <div class="form-group">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" id="email" class="form-input" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" class="form-input" placeholder="••••••••" required>
                </div>
                <button type="submit" id="authSubmit" class="btn btn-primary">
                    <span id="authSubmitText">Sign In</span>
                    <div id="authLoading" class="loading" style="display: none;"></div>
                </button>
            </form>
            
            <div class="auth-divider">
                <span>Or continue with</span>
            </div>
            
            <button id="googleSignIn" class="google-btn">
                <i class="fab fa-google"></i>
                Google
            </button>
            
            <div class="auth-links">
                <a id="toggleAuthMode" class="auth-link">Create an account</a>
                <a id="forgotPassword" class="auth-link">Forgot password?</a>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="appScreen" class="app-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-tasks"></i>
                    <span>TaskFlow</span>
                </div>
            </div>
            
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-details">
                    <div class="user-name" id="userName">User</div>
                    <div class="user-email" id="userEmail">user@example.com</div>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">Views</div>
                <div class="nav-item active" data-view="today">
                    <i class="fas fa-sun"></i>
                    <span>Today</span>
                </div>
                <div class="nav-item" data-view="upcoming">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Upcoming</span>
                </div>
                <div class="nav-item" data-view="all">
                    <i class="fas fa-list"></i>
                    <span>All Tasks</span>
                </div>
                <div class="nav-item" data-view="completed">
                    <i class="fas fa-check-circle"></i>
                    <span>Completed</span>
                </div>
                <div class="nav-item" data-view="starred">
                    <i class="fas fa-star"></i>
                    <span>Starred</span>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">Projects</div>
                <div class="nav-item" data-view="work">
                    <i class="fas fa-briefcase"></i>
                    <span>Work</span>
                </div>
                <div class="nav-item" data-view="personal">
                    <i class="fas fa-home"></i>
                    <span>Personal</span>
                </div>
                <div class="nav-item" data-view="shopping">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Shopping</span>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">Settings</div>
                <div class="nav-item" id="exportData">
                    <i class="fas fa-file-export"></i>
                    <span>Export Data</span>
                </div>
                <div class="nav-item" id="importData">
                    <i class="fas fa-file-import"></i>
                    <span>Import Data</span>
                </div>
            </div>
            
            <div style="flex-grow: 1;"></div>
            
            <button id="signOut" class="btn btn-secondary" style="width: 100%;">
                <i class="fas fa-sign-out-alt"></i>
                <span>Sign Out</span>
            </button>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1 class="view-title" id="currentView">Today</h1>
                <div class="header-actions">
                    <button class="btn btn-icon" id="searchToggle">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="btn btn-primary" id="newTaskBtn">
                        <i class="fas fa-plus"></i>
                        <span>New Task</span>
                    </button>
                </div>
            </div>
            
            <div class="quick-add">
                <input type="text" class="quick-add-input" placeholder="Quick add a task... Use #tags, @date, !priority">
                <div class="quick-add-hint">Press Enter to add</div>
            </div>
            
            <div class="kanban-board">
                <div class="kanban-column glass-card">
                    <div class="column-header">
                        <h3 class="column-title">To Do</h3>
                        <span class="task-count">3</span>
                    </div>
                    <div class="task-list" id="todo-column">
                        <div class="task-card glass-card" draggable="true">
                            <div class="task-header">
                                <div>
                                    <h4 class="task-title">Design homepage layout</h4>
                                    <p class="task-description">Create wireframes and mockups for the new homepage</p>
                                </div>
                                <i class="fas fa-ellipsis-v"></i>
                            </div>
                            <div class="task-meta">
                                <span class="task-tag">Design</span>
                                <span class="task-priority priority-high">High</span>
                                <span class="task-date">Today</span>
                            </div>
                        </div>
                        
                        <div class="task-card glass-card" draggable="true">
                            <div class="task-header">
                                <div>
                                    <h4 class="task-title">Write project proposal</h4>
                                    <p class="task-description">Draft the Q3 project proposal for client review</p>
                                </div>
                                <i class="fas fa-ellipsis-v"></i>
                            </div>
                            <div class="task-meta">
                                <span class="task-tag">Work</span>
                                <span class="task-priority priority-medium">Medium</span>
                                <span class="task-date">Tomorrow</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="kanban-column glass-card">
                    <div class="column-header">
                        <h3 class="column-title">In Progress</h3>
                        <span class="task-count">2</span>
                    </div>
                    <div class="task-list" id="inprogress-column">
                        <div class="task-card glass-card" draggable="true">
                            <div class="task-header">
                                <div>
                                    <h4 class="task-title">Develop user authentication</h4>
                                    <p class="task-description">Implement login and registration functionality</p>
                                </div>
                                <i class="fas fa-ellipsis-v"></i>
                            </div>
                            <div class="task-meta">
                                <span class="task-tag">Development</span>
                                <span class="task-priority priority-high">High</span>
                                <span class="task-date">Today</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="kanban-column glass-card">
                    <div class="column-header">
                        <h3 class="column-title">Done</h3>
                        <span class="task-count">1</span>
                    </div>
                    <div class="task-list" id="done-column">
                        <div class="task-card glass-card" draggable="true">
                            <div class="task-header">
                                <div>
                                    <h4 class="task-title">Research competitors</h4>
                                    <p class="task-description">Analyze 5 competitor products and document findings</p>
                                </div>
                                <i class="fas fa-ellipsis-v"></i>
                            </div>
                            <div class="task-meta">
                                <span class="task-tag">Research</span>
                                <span class="task-priority priority-low">Low</span>
                                <span class="task-date">Yesterday</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Task completed successfully!</span>
    </div>

    <!-- Theme Toggle -->
    <div class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCELYw9zEDgYk9Y2-ivjryu5fU_UOOulZM",
            authDomain: "task-manager-3ff20.firebaseapp.com",
            projectId: "task-manager-3ff20",
            storageBucket: "task-manager-3ff20.firebasestorage.app",
            messagingSenderId: "886222939115",
            appId: "1:886222939115:web:6d29c1e044178925ddafae",
            measurementId: "G-GYZJWK6KQW"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Enable offline persistence
        db.enablePersistence()
            .catch((err) => {
                console.error('Firebase persistence failed: ', err);
            });

        // DOM Elements
        const authScreen = document.getElementById('authScreen');
        const appScreen = document.getElementById('appScreen');
        const authForm = document.getElementById('authForm');
        const authSubmit = document.getElementById('authSubmit');
        const authSubmitText = document.getElementById('authSubmitText');
        const authLoading = document.getElementById('authLoading');
        const toggleAuthMode = document.getElementById('toggleAuthMode');
        const googleSignIn = document.getElementById('googleSignIn');
        const forgotPassword = document.getElementById('forgotPassword');
        const signOutBtn = document.getElementById('signOut');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userEmail = document.getElementById('userEmail');
        const themeToggle = document.getElementById('themeToggle');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const newTaskBtn = document.getElementById('newTaskBtn');
        const navItems = document.querySelectorAll('.nav-item');
        const currentView = document.getElementById('currentView');

        // App State
        let isLoginMode = true;
        let currentUser = null;

        // Initialize the app
        function initApp() {
            // Check for saved theme preference
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);

            // Set up auth state listener
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    showAppScreen();
                    updateUserInfo(user);
                    // In a real app, we would load user tasks from Firestore here
                } else {
                    showAuthScreen();
                }
            });

            // Set up event listeners
            setupEventListeners();
        }

        // Set up all event listeners
        function setupEventListeners() {
            // Auth form submission
            authForm.addEventListener('submit', handleAuthSubmit);
            
            // Toggle between login and signup
            toggleAuthMode.addEventListener('click', toggleAuthModeHandler);
            
            // Google sign in
            googleSignIn.addEventListener('click', handleGoogleSignIn);
            
            // Forgot password
            forgotPassword.addEventListener('click', handleForgotPassword);
            
            // Sign out
            signOutBtn.addEventListener('click', handleSignOut);
            
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // New task button
            newTaskBtn.addEventListener('click', showNewTaskModal);
            
            // Navigation items
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    // Remove active class from all items
                    navItems.forEach(i => i.classList.remove('active'));
                    // Add active class to clicked item
                    item.classList.add('active');
                    
                    // Update current view
                    const view = item.getAttribute('data-view');
                    currentView.textContent = item.querySelector('span').textContent;
                    
                    // In a real app, we would filter tasks based on the selected view
                    showToast(`Switched to ${item.querySelector('span').textContent} view`);
                });
            });
            
            // Drag and drop for tasks
            setupDragAndDrop();
            
            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
        }

        // Auth handlers
        function handleAuthSubmit(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            showAuthLoading(true);
            
            if (isLoginMode) {
                // Sign in
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        showAuthLoading(false);
                        showToast('Signed in successfully!');
                    })
                    .catch((error) => {
                        showAuthLoading(false);
                        showToast(error.message, 'error');
                    });
            } else {
                // Sign up
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        showAuthLoading(false);
                        showToast('Account created successfully!');
                    })
                    .catch((error) => {
                        showAuthLoading(false);
                        showToast(error.message, 'error');
                    });
            }
        }

        function toggleAuthModeHandler() {
            isLoginMode = !isLoginMode;
            authSubmitText.textContent = isLoginMode ? 'Sign In' : 'Sign Up';
            toggleAuthMode.textContent = isLoginMode ? 'Create an account' : 'Have an account?';
        }

        function handleGoogleSignIn() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then((result) => {
                    showToast('Signed in with Google!');
                })
                .catch((error) => {
                    showToast(error.message, 'error');
                });
        }

        function handleForgotPassword() {
            const email = document.getElementById('email').value;
            if (!email) {
                showToast('Please enter your email address', 'error');
                return;
            }
            
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    showToast('Password reset email sent!');
                })
                .catch((error) => {
                    showToast(error.message, 'error');
                });
        }

        function handleSignOut() {
            auth.signOut()
                .then(() => {
                    showToast('Signed out successfully');
                showAuthScreen();
                // Reset form
                    authForm.reset();
                })
                .catch((error) => {
                    showToast(error.message, 'error');
                });
        }

        // UI helpers
        function showAuthScreen() {
            authScreen.style.display = 'flex';
            appScreen.style.display = 'none';
        }

        function showAppScreen() {
            authScreen.style.display = 'none';
            appScreen.style.display = 'flex';
        }

        function showAuthLoading(show) {
            if (show) {
                authSubmitText.style.display = 'none';
                authLoading.style.display = 'inline-block';
                authSubmit.disabled = true;
            } else {
                authSubmitText.style.display = 'inline-block';
                authLoading.style.display = 'none';
                authSubmit.disabled = false;
            }
        }

        function updateUserInfo(user) {
            userAvatar.textContent = user.displayName ? user.displayName.charAt(0).toUpperCase() : user.email.charAt(0).toUpperCase();
            userName.textContent = user.displayName || 'User';
            userEmail.textContent = user.email;
        }

        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
            
            showToast(`${newTheme === 'light' ? 'Light' : 'Dark'} mode enabled`);
        }

        function updateThemeIcon(theme) {
            const icon = themeToggle.querySelector('i');
            icon.className = theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        }

        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            toast.className = `toast ${type === 'error' ? 'toast-error' : 'toast-success'}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function showNewTaskModal() {
            // In a real app, this would show a modal for creating a new task
            showToast('New task dialog would open here');
        }

        function setupDragAndDrop() {
            const taskCards = document.querySelectorAll('.task-card');
            const columns = document.querySelectorAll('.task-list');
            
            taskCards.forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
            });
            
            columns.forEach(column => {
                column.addEventListener('dragover', handleDragOver);
                column.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.id);
            setTimeout(() => {
                e.target.classList.add('dragging');
            }, 0);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            const id = e.dataTransfer.getData('text/plain');
            const draggable = document.getElementById(id);
            const afterElement = getDragAfterElement(e.target, e.clientY);
            
            if (afterElement) {
                e.target.insertBefore(draggable, afterElement);
            } else {
                e.target.appendChild(draggable);
            }
            
            draggable.classList.remove('dragging');
            showToast('Task moved successfully');
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.task-card:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function handleKeyboardShortcuts(e) {
            // '/' to focus search
            if (e.key === '/' && !e.ctrlKey && !e.metaKey) {
                e.preventDefault();
                document.querySelector('.quick-add-input').focus();
            }
            
            // 'n' to create new task
            if (e.key === 'n' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                showNewTaskModal();
            }
            
            // Space to toggle task completion (when a task is focused)
            if (e.key === ' ' && document.activeElement.classList.contains('task-card')) {
                e.preventDefault();
                // In a real app, this would toggle task completion
                showToast('Task completion toggled');
            }
        }

        // Initialize the app when the DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
